const api=window?.BOOM_WIDGET_API_CALENDAR;let state={tagId:"boom-events-org-calendar",id:null,cdn:"https://landsman.github.io/boom-widget-calendar/",prod:!0,locale:null,manual:!1};const attributes={id:"id",cdn:"cdn",prod:"prod",locale:"locale",manual:"manual"},queryParams={organizerId:"organizerId",isProduction:"isProduction",scrolling:"scrolling",locale:"locale"};async function loadFieldsFromDataAttributes(){return new Promise(((e,t)=>{const a=document.querySelector("#"+state.tagId),n=a.dataset[attributes.id];n?state[attributes.id]=n:t("organizerId id is not defined!");const s=a.dataset[attributes.manual];s&&(state[attributes.manual]=toBoolean(s));const r=a.dataset[attributes.cdn];r&&(state[attributes.cdn]=stripTrailingSlash(r));const o=a.dataset[attributes.prod];o&&(state[attributes.prod]=toBoolean(o));const i=a.dataset[attributes.locale];i&&(state[attributes.locale]=i),e()}))}function getUnixTime(){const e=new Date;return Math.floor(e.getTime()/1e3)}function getIdValue(e){return state.tagId+"__loader-"+e}function getIdValueEventListener(e){return state.tagId+"__event-listener-"+e}function stripTrailingSlash(e){return e.endsWith("/")?e.slice(0,-1):e}function toBoolean(e){return void 0!==e&&("false"===e&&"true"===e||console.warn("Please provide boolean value! This is not valid: ",e),"true"===e)}function stylesInstall(){const e=document.getElementById(state.tagId);if(!e)return void console.error("Tag not found!",state.tagId);const t=document.createElement("link");t.rel="stylesheet",t.id=getIdValue("css");let a=new URL(state[attributes.cdn]+"/api/loader.css");a.search=new URLSearchParams({v:getUnixTime()}),t.href=a.toString(),e.after(t)}function elementInstall(){const e=getIdValue("js"),t=document.getElementById(e);if(!t)return void console.error("Tag not found!",e);const a=document.createElement("div");a.id=getIdValue("element"),t.after(a)}function iframeInstall(){const e=getIdValue("element"),t=document.getElementById(e);if(!t)return void console.error("Tag not found!",e);const a=document.createElement("iframe");a.id=getIdValue("iframe"),a.scrolling="no";let n=new URL(state[attributes.cdn]+"/"),s={v:getUnixTime(),[queryParams.scrolling]:!1,[queryParams.isProduction]:state[attributes.prod],[queryParams.organizerId]:state[attributes.id]};state[attributes.locale]&&(s[queryParams.locale]=state[attributes.locale]),n.search=new URLSearchParams(s),a.src=n.toString(),t.innerHTML="",t.appendChild(a),listenIframeMessages(a)}function listenIframeMessages(e){window.addEventListener("message",(t=>{const a=t.data?.source,n=getIdValueEventListener("origin"),s=t.data?.type;if(a===n)switch(s){case"initialized":e.contentWindow.postMessage({source:getIdValueEventListener("consumer"),type:getIdValueEventListener("discovered"),currentUrl:window.location.href},"*");break;case"resize":e.height=t.data?.height;break;default:console.log("Unsupported eventType!",s)}else console.warn("listenIframeMessages - disabled",a)}),!1)}null!==api?state.manual||loadFieldsFromDataAttributes().then((()=>{stylesInstall(),elementInstall(),iframeInstall()})):console.error("BOOM_WIDGET_API_CALENDAR is null!");